<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>core.chat - Secure P2P Messaging</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <img src="https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/74607687/a6984013-d38a-4e22-8ace-736367e341fd/image.jpg?AWSAccessKeyId=ASIA2F3EMEYEUWLY6QNR&Signature=eIG0AIxxKiJthmujXFYiStV1jjI%3D&x-amz-security-token=IQoJb3JpZ2luX2VjEOb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIQDAinN7i14yR%2BQj1DPXec6WIB5OPHmagkxTjNprCZu45QIgERJGIo7DGS0PKcrtzEoPYekd8YadjAya0TWXDhwr%2FeEq%2FAQIn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARABGgw2OTk3NTMzMDk3MDUiDC63ebBBTl%2FN7sQaryrQBH%2F8QX2BpPoCagNMkZeBEQWvVnxdwbNrl6VMeqflStbqhpEgo042ozUohQZzgsDpDvR7Etm1Hi%2BH669tZWqIHuZGwfY2a4B68hYyU06Rj3SxMFdAg5t5XBO8tTD4804dwLfUkTHH2vaeqPaEqeU%2B7ZaHjQrxTi5QbLMO8wAXUqq9b0hJX0M5%2FcQ4TGx7V%2F3qfrvuiTydXXqFy3ZTi8%2FsGCAAWB550KS6e3tMiRICYztxIx18iBV9YT7RQEQMNlHW3BpGLrZ1qSAlmjvck%2BpK5JNNu05hB1PBhBNMJWHXPcURAUHEwsehmIv9Ax2L0Y5gOT7mmOXJlP%2FqG1kAigLiyimkep3LC2D8U6hI3Z7%2BNXDIy8dW7cnb2QQOvTWTJfxF0%2BGMtSXcx9ds3voWG1hN8QD49DU5AHDMtpfGzzjvvM%2BfM6wWll2AAROT1wOfrvOUYOWXwpBj0vK7cLZmUiHYHg27iNdboqSzI6xr%2F7tuQzAMXCCA7cqCSlPwTJulk5K1sQa4Nf0GTmIWnJj8tEXSCCvlabMtrqxL3hWAGEBDv%2B3vVzugoYNIesRX4k0%2F%2FqFgouVu6elr7v3ZOM%2F3sVMjIv5DEHKfVWXKP9tAiQMlFYu6F%2FeWdcFarxSKcmXXO%2FpWtSDrfzWWVAxzl3SiCU0%2F%2B9QtYp9dm2tUd17dXqD%2FLzolvWxlbu9FH5DQaiZcmi7DnwSBKWpDe%2BmKbsWtX%2FsWRUt3Wvy%2FNtnLHxmJ3oCLIALyoKlr%2B%2FceeNkOeqgmH9N%2FP8j%2FEHMeturLbSKifWIrVkQwgJD8xwY6mAEqFJWpaEmqZ7H%2Fb9oqKXm9Wg7%2BcMAokW%2B61s1sKeG%2FyyIxiQRaahlzHVZh9GJ2eD5Zr54oxb861nKR82FbC3rXkpg0P5wMPqxxPLvnWOaTzj6Rxnc%2FfGqcygecE1zggoa%2BdMTKkhqWQ1CkUH4lr9X6%2Fmqx6GvyGzOz0XSIwE%2F6zd1VBJI8adXmTNJYn%2Bp1sI3K67duj9dwLg%3D%3D&Expires=1761545317" alt="CLASH CRUZZ Logo" class="logo">
                <div class="brand">
                    <h1>core.chat</h1>
                    <p class="tagline">Secure P2P Messaging - Now Cross-Device!</p>
                </div>
            </div>
            <div class="header-controls">
                <button id="themeToggle" class="icon-btn" title="Toggle theme">
                    <span class="theme-icon">🌙</span>
                </button>
                <button id="infoBtn" class="icon-btn" title="About">
                    <span>ℹ️</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Connection Panel -->
        <div class="connection-panel" id="connectionPanel">
            <div class="connection-card">
                <div class="code-section">
                    <label>Your Chat Code</label>
                    <div class="code-display">
                        <span id="yourCode" class="code">------</span>
                        <button id="copyCodeBtn" class="btn-copy" title="Copy code">
                            <span>📋</span>
                        </button>
                    </div>
                </div>

                <div class="peer-section">
                    <label for="peerCodeInput">Connect to Peer</label>
                    <div class="peer-input-group">
                        <input 
                            type="text" 
                            id="peerCodeInput" 
                            placeholder="Enter peer's code" 
                            maxlength="6"
                            autocomplete="off"
                        >
                        <button id="connectBtn" class="btn-primary">Connect</button>
                    </div>
                </div>

                <div class="status-section">
                    <div class="status-indicator" id="statusIndicator">
                        <span class="status-dot disconnected"></span>
                        <span class="status-text">Disconnected</span>
                    </div>
                </div>
            </div>

            <button id="togglePanelBtn" class="toggle-panel-btn">
                <span>▼</span>
            </button>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Chat Area -->
            <div class="chat-area" id="chatArea">
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon">💬</div>
                    <h3>No Active Connection</h3>
                    <p>Share your code or enter a peer's code to start chatting</p>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <span class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
                <span>Peer is typing...</span>
            </div>

            <!-- Message Input Area -->
            <div class="message-input-area">
                <div class="input-toolbar">
                    <button id="emojiBtn" class="toolbar-btn" title="Emoji picker">
                        😀
                    </button>
                    <button id="fileBtn" class="toolbar-btn" title="Send file">
                        📎
                    </button>
                    <button id="searchBtn" class="toolbar-btn" title="Search messages">
                        🔍
                    </button>
                    <button id="exportBtn" class="toolbar-btn" title="Export chat">
                        💾
                    </button>
                    <button id="soundToggle" class="toolbar-btn" title="Toggle sound">
                        <span id="soundIcon">🔔</span>
                    </button>
                </div>
                <div class="input-container">
                    <textarea 
                        id="messageInput" 
                        placeholder="Type a message... (Shift+Enter for new line)"
                        rows="1"
                        maxlength="5000"
                    ></textarea>
                    <button id="sendBtn" class="btn-send" disabled>
                        <span>📤</span>
                    </button>
                </div>
                <div class="input-footer">
                    <span id="charCounter" class="char-counter">0 / 5000</span>
                    <span class="markdown-hint">**bold** *italic* `code`</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Emoji Picker Modal -->
    <div id="emojiPicker" class="modal" style="display: none;">
        <div class="modal-content emoji-picker-content">
            <div class="modal-header">
                <h3>Select Emoji</h3>
                <button class="modal-close" id="emojiPickerClose">×</button>
            </div>
            <div class="emoji-grid" id="emojiGrid">
                <!-- Emojis will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div id="searchModal" class="modal" style="display: none;">
        <div class="modal-content search-modal-content">
            <div class="modal-header">
                <h3>Search Messages</h3>
                <button class="modal-close" id="searchModalClose">×</button>
            </div>
            <input type="text" id="searchInput" placeholder="Search..." class="search-input">
            <div class="search-results" id="searchResults">
                <!-- Search results will appear here -->
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="modal" style="display: none;">
        <div class="modal-content info-modal-content">
            <div class="modal-header">
                <h3>About core.chat</h3>
                <button class="modal-close" id="infoModalClose">×</button>
            </div>
            <div class="info-content">
                <h4>How to Use</h4>
                <ol>
                    <li>Wait for your unique code to be generated (status: Ready)</li>
                    <li>Share your chat code with a friend (via SMS, email, etc.)</li>
                    <li>Enter your peer's code and click Connect</li>
                    <li>Start chatting securely with P2P encryption</li>
                    <li>Works across different devices, networks, and countries!</li>
                </ol>

                <h4>Features</h4>
                <ul>
                    <li>🌐 <strong>Cross-Device:</strong> Works on any device, any network</li>
                    <li>🔒 <strong>Secure:</strong> End-to-end P2P WebRTC connection</li>
                    <li>⚡ <strong>Real-time:</strong> Instant messaging with typing indicators</li>
                    <li>😀 Emoji reactions and picker</li>
                    <li>📎 File sharing (up to 5MB)</li>
                    <li>🔍 Message search</li>
                    <li>💾 Export chat history</li>
                    <li>✓✓ Read receipts &amp; delivery confirmations</li>
                    <li>🌓 Dark/Light theme toggle</li>
                    <li>📝 Markdown support (bold, italic, code)</li>
                </ul>

                <h4>Keyboard Shortcuts</h4>
                <ul>
                    <li><kbd>Enter</kbd> - Send message</li>
                    <li><kbd>Shift</kbd> + <kbd>Enter</kbd> - New line</li>
                    <li><kbd>Ctrl</kbd> + <kbd>K</kbd> - Focus peer code input</li>
                    <li><kbd>Ctrl</kbd> + <kbd>/</kbd> - Show this info</li>
                </ul>

                <h4>How It Works</h4>
                <p>core.chat uses PeerJS and WebRTC for direct peer-to-peer connections:</p>
                <ul>
                    <li>🔐 All messages are transmitted directly between devices</li>
                    <li>🚫 No messages are stored on any server</li>
                    <li>🌍 Automatic NAT traversal for cross-network connections</li>
                    <li>⚡ Free cloud-based signaling (no backend needed)</li>
                </ul>
                
                <p class="note"><strong>Important:</strong> Both users must have the app open simultaneously to connect. If connection fails, make sure your peer has opened the app and generated their code.</p>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" style="display: none;" accept="*/*">

    <script src="app.js"></script>
</body>
</html>